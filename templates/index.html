<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mastercam GitLab Interface</title>
    <link rel="stylesheet" href="/static/css/tailwind.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 min-h-screen font-sans transition-colors duration-300"
  >
    <div class="container mx-auto max-w-7xl">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
        <h1
          class="text-3xl sm:text-4xl font-bold text-center text-blue-800 dark:text-gold-500"
        >
          Mastercam Source File Tracker
        </h1>
        <p class="text-center text-gray-600 dark:text-gray-400 mt-2">
          Collaborative CAM file management
        </p>
      </div>

      <div
        class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 mb-6 flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0"
      >
        <div class="flex items-center space-x-2">
          <div
            id="connectionStatus"
            class="w-3 h-3 rounded-full animate-pulse bg-green-500"
          ></div>
          <span
            id="connectionText"
            class="text-sm text-gray-700 dark:text-gray-300"
            >Connected</span
          >
        </div>
        <div class="flex items-center space-x-2">
          <i class="fa-solid fa-user text-gray-500 dark:text-gray-400"></i>
          <span class="text-sm text-gray-700 dark:text-gray-300"
            >User:
            <span id="currentUser" class="font-semibold text-gold-500"
              >demo_user</span
            ></span
          >
        </div>
        <div class="flex items-center space-x-2">
          <i
            class="fa-solid fa-code-branch text-gray-500 dark:text-gray-400"
          ></i>
          <span class="text-sm text-gray-700 dark:text-gray-300"
            >Repository:
            <span id="repoStatus" class="font-semibold text-gold-500"
              >Ready</span
            ></span
          >
        </div>
      </div>

      <div
        class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 overflow-hidden"
      >
        <div
          class="flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0"
        >
          <div class="relative flex-1 w-full sm:max-w-md">
            <i
              class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"
            ></i>
            <input
              type="text"
              id="searchInput"
              placeholder="Search files..."
              class="w-full px-4 pl-10 py-2 border border-gray-300 dark:border-gray-600 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-gold-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-colors"
            />
          </div>
          <button
            class="flex items-center space-x-2 px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
            onclick="toggleConfigPanel()"
          >
            <i class="fa-solid fa-gear"></i>
            <span>Settings</span>
          </button>
        </div>

        <div
          id="fileList"
          class="divide-y divide-gray-200 dark:divide-gray-700"
        >
          <div
            class="flex justify-center items-center py-12 text-gray-500 dark:text-gray-400"
          >
            <div
              class="animate-spin rounded-full h-12 w-12 border-4 border-gray-300 dark:border-gray-600 border-t-blue-500 dark:border-t-gold-500"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="configPanel"
      class="fixed inset-y-0 right-0 w-full max-w-md transform translate-x-full transition-transform duration-300 bg-white dark:bg-gray-800 shadow-2xl p-6 z-50 overflow-y-auto"
    >
      <div
        class="flex justify-between items-center pb-4 mb-4 border-b border-gray-200 dark:border-gray-700"
      >
        <h3 class="text-2xl font-semibold text-gray-800 dark:text-gold-500">
          Settings
        </h3>
        <button
          class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gold-500"
          onclick="toggleConfigPanel()"
        >
          <i class="fa-solid fa-xmark text-2xl"></i>
        </button>
      </div>

      <form id="configForm" class="space-y-4">
        <div>
          <label
            for="gitlabUrl"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >GitLab URL</label
          >
          <input
            type="url"
            id="gitlabUrl"
            required
            class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-300 dark:focus:border-gold-500 focus:ring focus:ring-indigo-200 dark:focus:ring-gold-500 focus:ring-opacity-50 dark:focus:ring-opacity-30 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          />
        </div>
        <div>
          <label
            for="projectId"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >Project ID</label
          >
          <input
            type="text"
            id="projectId"
            required
            class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-300 dark:focus:border-gold-500 focus:ring focus:ring-indigo-200 dark:focus:ring-gold-500 focus:ring-opacity-50 dark:focus:ring-opacity-30 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          />
        </div>
        <div>
          <label
            for="username"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >Username</label
          >
          <input
            type="text"
            id="username"
            required
            class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-300 dark:focus:border-gold-500 focus:ring focus:ring-indigo-200 dark:focus:ring-gold-500 focus:ring-opacity-50 dark:focus:ring-opacity-30 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          />
        </div>
        <div>
          <label
            for="token"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300"
            >Access Token</label
          >
          <input
            type="password"
            id="token"
            required
            class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-300 dark:focus:border-gold-500 focus:ring focus:ring-indigo-200 dark:focus:ring-gold-500 focus:ring-opacity-50 dark:focus:ring-opacity-30 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          />
        </div>
        <button
          type="submit"
          class="w-full flex justify-center items-center space-x-2 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-gold-500 dark:hover:bg-gold-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-gold-500"
        >
          <i class="fa-solid fa-floppy-disk"></i>
          <span>Save Configuration</span>
        </button>
      </form>

      <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">
          Current Status
        </h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">
          <strong>Status:</strong>
          <span id="configStatusText" class="font-medium text-gold-500"
            >Not configured</span
          >
        </p>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          <strong>Repository:</strong>
          <span id="configRepoText" class="font-medium text-gold-500"
            >Not available</span
          >
        </p>
      </div>
    </div>

    <div class="fixed bottom-6 right-6 flex flex-col items-end space-y-4 z-40">
      <button
        class="bg-blue-600 text-white rounded-full shadow-lg p-4 hover:bg-blue-700 dark:bg-gold-500 dark:hover:bg-gold-600 transition-colors"
        title="Upload New File"
        onclick="showNewFileDialog()"
      >
        <i class="fa-solid fa-cloud-arrow-up text-lg"></i>
      </button>
      <button
        class="bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-full shadow-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
        title="Refresh"
        onclick="loadFiles()"
      >
        <i class="fa-solid fa-arrows-rotate text-lg"></i>
      </button>
      <button
        class="bg-blue-600 text-white rounded-full shadow-lg p-4 hover:bg-blue-700 dark:bg-gold-500 dark:hover:bg-gold-600 transition-colors"
        title="Settings"
        onclick="toggleConfigPanel()"
      >
        <i class="fa-solid fa-gear text-lg"></i>
      </button>
      <button
        class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-full shadow-lg p-4 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        title="Toggle Dark Mode"
        onclick="toggleDarkMode()"
      >
        <i class="fa-solid fa-moon text-lg"></i>
      </button>
    </div>

    <input type="file" id="fileUpload" class="hidden" accept=".mcam" />
    <input type="file" id="newFileSelect" class="hidden" accept=".mcam" />

    <div
      id="newFileModal"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-[100] hidden"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-lg text-gray-900 dark:text-gray-100"
      >
        <h3 class="text-xl font-semibold mb-4 text-gold-500">
          Upload New File
        </h3>
        <form id="newFileUploadForm">
          <div class="mb-4">
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >File</label
            >
            <input
              type="file"
              id="newFileSelect"
              required
              accept=".mcam"
              class="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:dark:bg-gray-700 file:text-gray-700 file:dark:text-gray-200 hover:file:bg-gray-200 hover:file:dark:bg-gray-600"
            />
          </div>
          <div class="mb-4">
            <label
              for="initialRev"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Initial Revision</label
            >
            <input
              type="text"
              id="initialRev"
              value="1.0"
              required
              class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-300 dark:focus:border-gold-500 focus:ring focus:ring-indigo-200 dark:focus:ring-gold-500 focus:ring-opacity-50 dark:focus:ring-opacity-30 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            />
          </div>
          <div class="flex justify-end space-x-2">
            <button
              type="button"
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
              onclick="closeModal('newFileModal')"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-gold-500 rounded-md hover:bg-gold-600 transition-colors"
            >
              Upload
            </button>
          </div>
        </form>
      </div>
    </div>

    <div
      id="checkinModal"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-[100] hidden"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-gray-900 dark:text-gray-100"
      >
        <h3 class="text-xl font-semibold mb-4 text-gold-500">
          Check In
          <span
            id="checkinFileName"
            class="text-gray-800 dark:text-gray-200"
          ></span>
        </h3>
        <p class="mb-4 text-sm text-gray-600 dark:text-gray-400">
          Current Version: <span id="currentFileVersion"></span>
        </p>
        <div class="space-y-3">
          <button
            class="w-full flex items-center space-x-3 px-4 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"
            onclick="performCheckin('major')"
          >
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span>Major Revision (e.g., v1.2 → v2.0)</span>
          </button>
          <button
            class="w-full flex items-center space-x-3 px-4 py-3 bg-gray-300 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-400 dark:hover:bg-gray-600 transition-colors"
            onclick="performCheckin('minor')"
          >
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span>Minor Revision (e.g., v1.2 → v1.3)</span>
          </button>
        </div>
      </div>
    </div>

    <script src="/static/js/script.js"></script>
  </body>
</html>
